;(function(root,factory){if(typeof define==='function'&&define.amd){define(function(){return factory(root)})}else if(typeof exports==='object'){module.exports=factory}else{root.crazyload=factory(root)}})(window,function(root){function _inView(obj,view){if(!obj.offsetParent){return false}var offset=obj.getBoundingClientRect();return offset.top<=view.b&&offset.bottom>=view.t&&offset.left<=view.r&&offset.right>=view.l}function _extend(target,source){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}return target}function throttle(fn,delay,duration){var timer=null;var previous=null;return function(){var now=+new Date();if(!previous)previous=now;if(duration&&now-previous>duration){fn();previous=now;clearTimeout(timer)}else{clearTimeout(timer);timer=setTimeout(function(){fn();previous=null},delay)}}}function addEventListener(target,event,func){if(document.addEventListener){target.addEventListener(event,func,false)}else if(document.documentElement.attachEvent){target.attachEvent('on'+event,func,false)}else{target['on'+event]=func}}var crazyload={option:{offsetTop:0,offsetBottom:0,offsetLeft:0,offsetRight:0,offset:0,delay:150,duration:300,target:root,callback:function(){}}};crazyload.init=function(option){this.option=_extend(this.option,option);this.render();addEventListener(crazyload.option.target,'scroll',throttle(crazyload.render,crazyload.option.delay,crazyload.option.duration));addEventListener(crazyload.option.target,'load',throttle(crazyload.render,crazyload.option.delay,crazyload.option.duration))};crazyload.render=function(){var nodes=document.querySelectorAll('[data-crazy], [data-crazy-back]');var view={l:0-crazyload.option.offsetLeft,t:0-crazyload.option.offsetTop,b:(root.innerHeight||document.documentElement.clientHeight)+crazyload.option.offsetBottom,r:(root.innerWidth||document.documentElement.clientWidth)+crazyload.option.offsetRight};var ele=null;var src='';for(var i=0,num=nodes.length;i<num;i++){ele=nodes[i];if(_inView(ele,view)){if(ele.getAttribute('data-crazy-back')){ele.style.backgroundImage='url('+ele.getAttribute('data-crazy-back')+')'}else if((src=ele.getAttribute('data-crazy'))!==ele.src){ele.src=src}ele.removeAttribute('data-crazy-back');ele.removeAttribute('data-crazy');crazyload.option.callback(ele)}}};return crazyload});